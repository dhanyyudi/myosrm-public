<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OSRM Inspector</title>
    <link
      href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div id="app">
      <!-- Left Sidebar -->
      <aside id="sidebar">
        <div class="sidebar-header">
          <h1><i class="fa fa-route"></i> OSRM Inspector</h1>
        </div>

        <div class="sidebar-body">
          <!-- Card: Road Network -->
          <div class="card" id="card-profile">
            <div class="card-header">
              <i class="fa fa-server"></i> Road Network
            </div>
            <div class="card-body">
              <div class="info-row">
                <span class="info-label">Profile</span>
                <span class="info-value" id="profile-display">--</span>
                <button id="btn-edit-profile" class="btn-icon-sm" title="Change profile">
                  <i class="fa fa-pen"></i>
                </button>
              </div>
              <div class="info-row">
                <span class="info-label">Algorithm</span>
                <span class="info-value" id="algorithm-display">MLD</span>
              </div>
            </div>
          </div>

          <!-- Card: Waypoints -->
          <div class="card" id="card-waypoints">
            <div class="card-header">
              <i class="fa fa-map-marker-alt"></i> Waypoints
            </div>
            <div class="card-body">
              <div class="waypoints-container" id="waypoints-container">
                <div class="waypoint-row" data-type="start" draggable="true">
                  <div class="drag-handle" title="Drag to reorder">
                    <i class="fa fa-grip-vertical"></i>
                  </div>
                  <div class="waypoint-marker start">A</div>
                  <input
                    type="text"
                    id="start-point"
                    placeholder="Click map or enter lng,lat"
                    class="waypoint-input"
                  />
                  <button class="btn-icon-sm btn-remove-waypoint" id="btn-clear-start" title="Clear">
                    <i class="fa fa-times"></i>
                  </button>
                </div>
                <div class="waypoint-row" data-type="end" draggable="true">
                  <div class="drag-handle" title="Drag to reorder">
                    <i class="fa fa-grip-vertical"></i>
                  </div>
                  <div class="waypoint-marker end">B</div>
                  <input
                    type="text"
                    id="end-point"
                    placeholder="Click map or enter lng,lat"
                    class="waypoint-input"
                  />
                  <button class="btn-icon-sm btn-remove-waypoint" id="btn-clear-end" title="Clear">
                    <i class="fa fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="waypoint-actions">
                <button id="btn-add-waypoint" class="btn btn-outline btn-sm">
                  <i class="fa fa-plus"></i> Add Via
                </button>
                <button id="btn-import-csv" class="btn btn-outline btn-sm">
                  <i class="fa fa-file-csv"></i> Import
                </button>
                <button id="btn-load-url" class="btn btn-outline btn-sm">
                  <i class="fa fa-upload"></i> Load URL
                </button>
                <input
                  type="file"
                  id="waypoint-file-input"
                  accept=".csv,.txt"
                  style="display: none"
                />
              </div>
            </div>
          </div>

          <!-- Card: Options -->
          <div class="card" id="card-options">
            <div class="card-header">
              <i class="fa fa-sliders-h"></i> Options
            </div>
            <div class="card-body">
              <!-- TD controls (shown/hidden by JS based on runtime-config) -->
              <div id="td-controls" class="option-section">
                <label class="option-label">Departure Time</label>
                <div class="time-input-row">
                  <input
                    type="datetime-local"
                    id="departure-time"
                    class="form-control"
                  />
                  <button
                    id="btn-use-current-time"
                    class="btn btn-outline btn-sm"
                    title="Set to current time"
                  >
                    <i class="fa fa-clock"></i> Now
                  </button>
                </div>
                <label class="checkbox-row">
                  <input type="checkbox" id="enable-time-routing" />
                  <span>Time-dependent routing</span>
                  <i
                    class="fa fa-info-circle info-tip"
                    title="Uses historical traffic data based on departure time"
                  ></i>
                </label>
              </div>

              <!-- Auto-update -->
              <label class="checkbox-row">
                <input type="checkbox" id="auto-update-route" checked />
                <span>Auto-update on drag</span>
              </label>

              <!-- Route Labels -->
              <div class="option-section">
                <label class="option-label">Route Label</label>
                <div class="radio-pill-group" id="route-label-options">
                  <label class="radio-pill">
                    <input
                      type="radio"
                      name="route-label"
                      value="none"
                      checked
                    />
                    <span>None</span>
                  </label>
                  <label class="radio-pill">
                    <input type="radio" name="route-label" value="order" />
                    <span>Order</span>
                  </label>
                  <label class="radio-pill">
                    <input type="radio" name="route-label" value="duration" />
                    <span>Duration</span>
                  </label>
                  <label class="radio-pill">
                    <input type="radio" name="route-label" value="speed" />
                    <span>Speed</span>
                  </label>
                  <label class="radio-pill">
                    <input type="radio" name="route-label" value="wayid" />
                    <span>Way ID</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Card: Debug -->
          <div class="card" id="card-debug">
            <div class="card-header">
              <i class="fa fa-bug"></i> Debug
            </div>
            <div class="card-body">
              <div class="btn-toggle-group">
                <button id="btn-show-nodes" class="btn btn-toggle">
                  <i class="fa fa-dot-circle"></i> Nodes
                </button>
                <button id="btn-show-edges" class="btn btn-toggle">
                  <i class="fa fa-project-diagram"></i> Edges
                </button>
                <button id="btn-show-speed" class="btn btn-toggle">
                  <i class="fa fa-tachometer-alt"></i> Speed
                </button>
              </div>
              <button
                id="btn-clear-debug"
                class="btn btn-outline btn-sm btn-full"
              >
                <i class="fa fa-broom"></i> Clear Debug
              </button>
            </div>
          </div>

          <!-- Card: Service Area -->
          <div class="card" id="card-routing-area">
            <div class="card-header">
              <i class="fa fa-draw-polygon"></i> Service Area
            </div>
            <div class="card-body">
              <div class="btn-toggle-group">
                <button id="btn-load-routing-area" class="btn btn-toggle">
                  <i class="fa fa-download"></i> Load
                </button>
                <button id="btn-upload-routing-area" class="btn btn-toggle">
                  <i class="fa fa-upload"></i> Upload
                </button>
                <button
                  id="btn-toggle-routing-area"
                  class="btn btn-toggle active"
                >
                  <i class="fa fa-eye"></i> Show
                </button>
              </div>
              <input
                type="file"
                id="routing-area-file-input"
                accept=".geojson,.json"
                style="display: none"
              />
            </div>
          </div>

          <!-- Card: Step Info (visible after route found) -->
          <div class="card" id="card-step-info" style="display: none">
            <div class="card-header card-header-collapsible" id="step-info-toggle">
              <span><i class="fa fa-list-ol"></i> Step Info</span>
              <i class="fa fa-chevron-down card-collapse-icon"></i>
            </div>
            <div class="card-body card-body-collapsible" id="step-info-body">
              <div id="route-steps" class="step-info-scroll"></div>
            </div>
          </div>

          <!-- Card: Results (visible after route found) -->
          <div class="card" id="card-results" style="display: none">
            <div class="card-header">
              <i class="fa fa-clipboard-list"></i> Results
            </div>
            <div class="card-body">
              <div class="btn-toggle-group results-btn-group">
                <button id="btn-show-routing-url" class="btn btn-toggle">
                  <i class="fa fa-link"></i> Routing URL
                </button>
                <button id="btn-show-waypoints" class="btn btn-toggle">
                  <i class="fa fa-map-pin"></i> Waypoints
                </button>
                <button id="btn-show-wayids" class="btn btn-toggle">
                  <i class="fa fa-hashtag"></i> Way IDs
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Pinned Action Buttons -->
        <div class="sidebar-actions">
          <button id="btn-find-route" class="btn btn-primary btn-lg">
            <i class="fa fa-route"></i> Find Route
          </button>
          <button id="btn-clear-route" class="btn btn-outline btn-lg">
            <i class="fa fa-trash-alt"></i> Clear All
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main id="main-content">
        <!-- Map -->
        <div id="map-container">
          <div id="map"></div>

          <!-- Map Controls -->
          <div class="map-controls top-left">
            <button id="btn-sidebar-toggle" class="btn btn-map">
              <i class="fa fa-bars"></i>
            </button>
            <button id="btn-zoom-in" class="btn btn-map">
              <i class="fa fa-plus"></i>
            </button>
            <button id="btn-zoom-out" class="btn btn-map">
              <i class="fa fa-minus"></i>
            </button>
          </div>

          <!-- Route Stats Overlay -->
          <div id="route-stats" class="map-card top-right" style="display: none">
            <div class="stat-row">
              <i class="fa fa-road"></i>
              <span id="stat-distance">--</span>
            </div>
            <div class="stat-row">
              <i class="fa fa-clock"></i>
              <span id="stat-duration">--</span>
            </div>
            <div class="stat-row">
              <i class="fa fa-tachometer-alt"></i>
              <span id="stat-speed">--</span>
            </div>
          </div>

          <!-- Coordinates Display -->
          <div id="coordinates-display" class="map-card bottom-right"></div>

          <!-- Routing Area Info -->
          <div
            id="routing-area-info"
            class="map-card bottom-left"
            style="display: none"
          >
            <i class="fa fa-draw-polygon"></i>
            <span>Area: <strong id="routing-area-name">--</strong></span>
          </div>
        </div>

        <!-- Hidden containers for data (used by modals) -->
        <div style="display:none">
          <div id="waypoints-table"></div>
          <div id="way-ids-table"></div>
          <!-- Note: Way IDs are derived from OSRM annotation.nodes data -->
        </div>
      </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-indicator" style="display: none">
      <div class="spinner"></div>
      <span>Processing...</span>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="sweetalert-helpers.js"></script>
    <script src="config.js"></script>
    <script src="backend-settings.js"></script>
    <script src="utils.js"></script>
    <script src="map.js"></script>
    <script src="routing.js"></script>
    <script src="debug.js"></script>
    <script src="routing-area.js"></script>
    <script src="app.js"></script>
  </body>
</html>
